Oracle Data Guard Prerequisites

Primary and Standby should be running same platform and OS
Primary and Standby can have hardware differences (number of CPUs/memory/storage)
Primary and Standby should be running same RDBMS software release/version
Primary database must be running in ARCHIVELOG mode
Primary database must be running in FORCE LOGGING mode

It is highly recommended to enable FLASHBACK option in Primary database

--------------------------------

with Data Guard, NOLOGGING/UNRECOVERABLE operations are not allowed.

CREATE/ALTER TABLE OR INDEX ... NOLOGGING
Direct load with SQL*Loader with NOLOGGING
INSERT with NOLOGGING

ALTER DATABASE FORCE LOGGING ;

Use this command to put the database into FORCE LOGGING mode. The database must be mounted or open. Database waits for all ongoing unlogged operations to finish.

In FORCE LOGGING mode, Database logs all changes in the database except changes in temporary tablespaces and temporary segments. This setting takes precedence over and is independent of any NOLOGGING or FORCE LOGGING settings you specify for individual tablespaces and any NOLOGGING settings you specify for individual database objects.

--------------------------------

Password File : Create a password file if one does not already exist. Every database in a Data Guard configuration must use a password file, and the password for the SYS user must be identical on every system for redo data transmission to succeed.

[oracle@mgspd ~]$ ll $ORACLE_HOME/dbs/orapw`echo $ORACLE_SID`
-rw-r----- 1 oracle oinstall 7680 Dec 12 18:09 /u01/app/oracle/product/12.1.0/dbHome_1/dbs/orapwsolid

solid:SYS@SQL> select * from v$pwfile_users;

USERNAME                       SYSDB SYSOP SYSAS SYSBA SYSDG SYSKM     CON_ID
------------------------------ ----- ----- ----- ----- ----- ----- ----------
SYS                            TRUE  TRUE  FALSE FALSE FALSE FALSE          0
SYSDG                          FALSE FALSE FALSE FALSE TRUE  FALSE          0
SYSBACKUP                      FALSE FALSE FALSE TRUE  FALSE FALSE          0
SYSKM                          FALSE FALSE FALSE FALSE FALSE TRUE           0

===========================================================================

-- check RDBMS software release/version

[oracle@mgspd ~]$ echo $ORACLE_HOME
/u01/app/oracle/product/12.1.0/dbHome_1

[oracle@mgspd ~]$ $ORACLE_HOME/OPatch/opatch version
OPatch Version: 12.1.0.1.3

OPatch succeeded.

[oracle@mgspd ~]$ $ORACLE_HOME/OPatch/opatch lsinventory
or
[oracle@mgspd ~]$ $ORACLE_HOME/OPatch/opatch lsinventory -oh $ORACLE_HOME

Oracle Interim Patch Installer version 12.1.0.1.3
Copyright (c) 2016, Oracle Corporation.  All rights reserved.


Oracle Home       : /u01/app/oracle/product/12.1.0/dbHome_1
Central Inventory : /u01/app/oraInventory
   from           : /u01/app/oracle/product/12.1.0/dbHome_1/oraInst.loc
OPatch version    : 12.1.0.1.3
OUI version       : 12.1.0.2.0
Log file location : /u01/app/oracle/product/12.1.0/dbHome_1/cfgtoollogs/opatch/opatch2016-12-16_15-07-30PM_1.log

Lsinventory Output file location : /u01/app/oracle/product/12.1.0/dbHome_1/cfgtoollogs/opatch/lsinv/lsinventory2016-12-16_15-07-30PM.txt

--------------------------------------------------------------------------------
Installed Top-level Products (1):

Oracle Database 12c                                                  12.1.0.2.0
There are 1 products installed in this Oracle Home.


There are no Interim patches installed in this Oracle Home.


--------------------------------------------------------------------------------

OPatch succeeded.

[oracle@mgspd ~]$

===========================================================================

-- Primary database must be running in ARCHIVELOG mode

-- check database ARCHIVELOG mode

solid:SYS@SQL> archive log list
Database log mode              Archive Mode
Automatic archival             Enabled
Archive destination            USE_DB_RECOVERY_FILE_DEST
Oldest online log sequence     19
Next log sequence to archive   21
Current log sequence           21
solid:SYS@SQL>

solid:SYS@SQL> SELECT DISTINCT name db_name, log_mode archive_log_mode, force_logging FROM gv$database ;

DB_NAME   ARCHIVE_LOG_ FORCE_LOGGING
--------- ------------ ---------------------------------------
SOLID     ARCHIVELOG   NO
solid:SYS@SQL>


===========================================================================

-- change database to NO ARCHIVELOG mode (single instance or RAC uses same method) :

[grid@rex1 ~]$ srvctl status database -database solid
Instance solid1 is running on node rex1
Instance solid2 is running on node rex2


[grid@rex1 ~]$ srvctl stop database -db solid -stopoption IMMEDIATE -force
-- using SQL : shutdown immediate ;

[grid@rex1 ~]$ srvctl status database -database solid
Instance solid1 is not running on node rex1
Instance solid2 is not running on node rex2


-- on any 1 node of RAC
[oracle@rex1 ~]$ . oraenv
ORACLE_SID = [solid1] ?
The Oracle base remains unchanged with value /u01/app/oracle

[oracle@rex1 ~]$ sqlplus / as sysdba
SQL*Plus: Release 12.1.0.2.0 Production on Tue Dec 20 16:00:59 2016
Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Connected to an idle instance.

-- mount the database

solid1:SYS@SQL> startup mount ;
ORACLE instance started.

Total System Global Area 3238002688 bytes
Fixed Size                  2929600 bytes
Variable Size            1946160192 bytes
Database Buffers         1275068416 bytes
Redo Buffers               13844480 bytes
Database mounted.

solid1:SYS@SQL> archive log list ;
Database log mode              Archive Mode
Automatic archival             Enabled
Archive destination            USE_DB_RECOVERY_FILE_DEST
Oldest online log sequence     13
Next log sequence to archive   14
Current log sequence           14

-- database is in ARCHIVELOG mode

solid1:SYS@SQL> alter database noarchivelog ;

solid1:SYS@SQL> archive log list ;
Database log mode              No Archive Mode
Automatic archival             Disabled
Archive destination            USE_DB_RECOVERY_FILE_DEST
Oldest online log sequence     13
Current log sequence           14

-- database changed to NO ARCHIVELOG mode

solid1:SYS@SQL> shutdown immediate ;
ORA-01109: database not open
Database dismounted.
ORACLE instance shut down.
solid1:SYS@SQL> exit


-- start database on all nodes

[grid@rex1 ~]$ srvctl status database -database solid
Instance solid1 is not running on node rex1
Instance solid2 is not running on node rex2

[grid@rex1 ~]$ srvctl start database -database solid

[grid@rex1 ~]$ srvctl status database -database solid
Instance solid1 is running on node rex1
Instance solid2 is running on node rex2


[oracle@rex1 ~]$ sqlplus / as sysdba
SQL*Plus: Release 12.1.0.2.0 Production on Tue Dec 20 16:41:04 2016
Copyright (c) 1982, 2014, Oracle.  All rights reserved.

solid1:SYS@SQL> archive log list
Database log mode              No Archive Mode
Automatic archival             Disabled
Archive destination            USE_DB_RECOVERY_FILE_DEST
Oldest online log sequence     13
Current log sequence           14

solid1:SYS@SQL> SELECT DISTINCT name db_name, log_mode archive_log_mode, force_logging FROM gv$database ;

DB_NAME   ARCHIVE_LOG_ FORCE_LOGGING
--------- ------------ ---------------------------------------
SOLID     NOARCHIVELOG NO


-- database changed to NO ARCHIVELOG mode

===========================================================================

-- change database to ARCHIVELOG mode (single instance or RAC uses same method) :

-- configure log_archive_format
-- ALTER SYSTEM SET log_archive_format='arch_%t_%s_%r.arc' SCOPE=spfile SID='*' ;

solid1:SYS@SQL> show parameter log_archive_format

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
log_archive_format                   string      %t_%s_%r.dbf


-- configure log_archive_dest_1 : if not set, archive logs will go to FRA
-- ALTER SYSTEM SET log_archive_dest_1='location=/u04/oradata/archive/' SCOPE=spfile SID='*' ;
-- ALTER SYSTEM SET log_archive_dest_1='location=+FRA_DG' SCOPE=spfile SID='*' ;

solid1:SYS@SQL> show parameter log_archive_dest_1

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
log_archive_dest_1                   string


-- check FRA configuration

solid1:SYS@SQL> show parameter db_recovery_file

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
db_recovery_file_dest                string      +FRA
db_recovery_file_dest_size           big integer 9G



[grid@rex1 ~]$ srvctl status database -database solid
Instance solid1 is running on node rex1
Instance solid2 is running on node rex2


[grid@rex1 ~]$ srvctl stop database -db solid -stopoption IMMEDIATE -force
-- using SQL : shutdown immediate ;

[grid@rex1 ~]$ srvctl status database -database solid
Instance solid1 is not running on node rex1
Instance solid2 is not running on node rex2


-- on any 1 node of RAC
[oracle@rex1 ~]$ sqlplus / as sysdba
SQL*Plus: Release 12.1.0.2.0 Production on Tue Dec 20 17:39:13 2016
Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Connected to an idle instance.

-- mount the database

solid1:SYS@SQL> startup mount ;
ORACLE instance started.

Total System Global Area 3238002688 bytes
Fixed Size                  2929600 bytes
Variable Size            1946160192 bytes
Database Buffers         1275068416 bytes
Redo Buffers               13844480 bytes
Database mounted.

-- database is in NO ARCHIVELOG mode

solid1:SYS@SQL> archive log list ;
Database log mode              No Archive Mode
Automatic archival             Disabled
Archive destination            USE_DB_RECOVERY_FILE_DEST
Oldest online log sequence     13
Current log sequence           14

solid1:SYS@SQL> alter database archivelog ;

solid1:SYS@SQL> archive log list ;
Database log mode              Archive Mode
Automatic archival             Enabled
Archive destination            USE_DB_RECOVERY_FILE_DEST
Oldest online log sequence     13
Next log sequence to archive   14
Current log sequence           14

-- database changed to ARCHIVELOG mode

solid1:SYS@SQL> shutdown immediate ;
ORA-01109: database not open
Database dismounted.
ORACLE instance shut down.
solid1:SYS@SQL> exit


-- start database on all nodes

[grid@rex1 ~]$ srvctl status database -database solid
Instance solid1 is not running on node rex1
Instance solid2 is not running on node rex2

[grid@rex1 ~]$ srvctl start database -database solid

[grid@rex1 ~]$ srvctl status database -database solid
Instance solid1 is running on node rex1
Instance solid2 is running on node rex2



[oracle@rex1 ~]$ sqlplus / as sysdba
SQL*Plus: Release 12.1.0.2.0 Production on Tue Dec 20 17:42:40 2016
Copyright (c) 1982, 2014, Oracle.  All rights reserved.

solid1:SYS@SQL> archive log list
Database log mode              Archive Mode
Automatic archival             Enabled
Archive destination            USE_DB_RECOVERY_FILE_DEST
Oldest online log sequence     13
Next log sequence to archive   14
Current log sequence           14

solid1:SYS@SQL> SELECT DISTINCT name db_name, log_mode archive_log_mode, force_logging FROM gv$database ;

DB_NAME   ARCHIVE_LOG_ FORCE_LOGGING
--------- ------------ ---------------------------------------
SOLID     ARCHIVELOG   NO

-- database changed to ARCHIVELOG mode

===========================================================================

-- change database to run in FORCE LOGGING mode :

solid1:SYS@SQL> SELECT DISTINCT name db_name, log_mode archive_log_mode, force_logging FROM gv$database ;

DB_NAME   ARCHIVE_LOG_ FORCE_LOGGING
--------- ------------ ---------------------------------------
SOLID     ARCHIVELOG   NO


solid1:SYS@SQL> ALTER DATABASE FORCE LOGGING ;


solid1:SYS@SQL> SELECT DISTINCT name db_name, log_mode archive_log_mode, force_logging FROM gv$database ;

DB_NAME   ARCHIVE_LOG_ FORCE_LOGGING
--------- ------------ ---------------------------------------
SOLID     ARCHIVELOG   YES

===========================================================================
===========================================================================
===========================================================================
